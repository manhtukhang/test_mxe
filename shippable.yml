# Author: Khang Mạnh Tử
build_environment: ubuntu1204
language: go
go:
  - release
#compiler:
  #- gcc
  # - clang

before_install:
  - sudo add-apt-repository ppa:ubuntu-toolchain-r/test -y
  - sudo apt-get update -qq
  # - sudo apt-get upgrade -y
  - sudo apt-get install g++-4.8 g++-4.8-multilib autopoint intltool unzip g++-multilib libc6-dev-i386 gperf tree -y
  - sudo apt-get install autoconf automake bash bison bzip2 cmake flex gettext git g++ intltool libffi-dev libtool libltdl-dev libssl-dev libxml-parser-perl make openssl patch perl pkg-config scons sed unzip wget xz-utils -y
  - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.8 50
  - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.8 50
  - git clone --branch=master https://github.com/mxe/mxe.git $HOME/mxe
before_script:
  - MINS=15
  - NUM_JOBS=$(grep processor /proc/cpuinfo | wc -l)
  - echo $NUM_JOBS
  - cd $HOME/mxe
  - while [ $MINS -gt 0 ]; do echo -e "\n$MINS\033[0K\r\n"; sleep 60; MINS=$((MINS-1)); done & make gcc flex bison --jobs=$NUM_JOBS
  - tree > tree.txt
  - cat tree.txt

branches:
  only:
    - shipable
